<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Документация</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        line-height: 1.6;
        color: #24292e;
        background: #f6f8fa;
        padding: 20px;
      }
      .container {
        max-width: 900px;
        margin: 0 auto;
        background: white;
        padding: 40px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      .back-btn {
        display: inline-block;
        margin-bottom: 20px;
        padding: 8px 16px;
        background: #42b883;
        color: white;
        text-decoration: none;
        border-radius: 6px;
        font-weight: 600;
        transition: background 0.2s;
      }
      .back-btn:hover {
        background: #359268;
      }
      #content h1 {
        color: #35495e;
        border-bottom: 3px solid #42b883;
        padding-bottom: 12px;
        margin-bottom: 24px;
      }
      #content h2 {
        color: #2c3e50;
        margin-top: 32px;
        margin-bottom: 16px;
        border-bottom: 2px solid #e1e4e8;
        padding-bottom: 8px;
      }
      #content h3 {
        color: #42b883;
        margin-top: 24px;
        margin-bottom: 12px;
      }
      #content p {
        margin-bottom: 16px;
      }
      #content ul,
      #content ol {
        margin-left: 24px;
        margin-bottom: 16px;
      }
      #content li {
        margin-bottom: 8px;
      }
      #content code {
        background: #f6f8fa;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: 'SF Mono', Monaco, Consolas, monospace;
        font-size: 0.9em;
        color: #d73a49;
      }
      #content pre {
        background: #2d2d2d;
        color: #f8f8f2;
        padding: 16px;
        border-radius: 6px;
        overflow-x: auto;
        margin-bottom: 16px;
      }
      #content pre code {
        background: none;
        color: inherit;
        padding: 0;
        font-size: 14px;
      }
      #content blockquote {
        border-left: 4px solid #42b883;
        padding-left: 16px;
        color: #6a737d;
        margin-bottom: 16px;
      }
      #content table {
        border-collapse: collapse;
        width: 100%;
        margin-bottom: 16px;
      }
      #content th,
      #content td {
        border: 1px solid #e1e4e8;
        padding: 8px 12px;
        text-align: left;
      }
      #content th {
        background: #f6f8fa;
        font-weight: 600;
      }
      #content strong {
        color: #24292e;
        font-weight: 600;
      }
      .loading {
        text-align: center;
        padding: 40px;
        color: #6a737d;
      }
      .error {
        background: #fff3cd;
        border: 2px solid #ffc107;
        border-radius: 6px;
        padding: 16px;
        color: #856404;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <a href="/examples/" class="back-btn">← Назад к примерам</a>
      <div id="content" class="loading">Загрузка документации...</div>
    </div>

    <script type="module">
      // Простой markdown парсер
      function parseMarkdown(md) {
        let html = md;

        // Заголовки
        html = html.replace(/^### (.*$)/gim, '<h3>$1</h3>');
        html = html.replace(/^## (.*$)/gim, '<h2>$1</h2>');
        html = html.replace(/^# (.*$)/gim, '<h1>$1</h1>');

        // Жирный текст
        html = html.replace(/\*\*(.*?)\*\*/gim, '<strong>$1</strong>');

        // Код блоки
        html = html.replace(
          /```(\w+)?\n([\s\S]*?)```/gim,
          '<pre><code>$2</code></pre>',
        );

        // Inline код
        html = html.replace(/`([^`]+)`/gim, '<code>$1</code>');

        // Списки
        html = html.replace(/^\* (.*$)/gim, '<li>$1</li>');
        html = html.replace(/^\- (.*$)/gim, '<li>$1</li>');
        html = html.replace(/(<li>.*<\/li>)/gis, '<ul>$1</ul>');

        // Нумерованные списки
        html = html.replace(/^\d+\. (.*$)/gim, '<li>$1</li>');

        // Параграфы
        html = html.replace(/\n\n(?!<[uo]l>|<h[1-6]>|<pre>)/g, '</p><p>');
        html = '<p>' + html + '</p>';

        // Очистка
        html = html.replace(/<p><\/p>/g, '');
        html = html.replace(/<p>(<h[1-6]>)/g, '$1');
        html = html.replace(/(<\/h[1-6]>)<\/p>/g, '$1');
        html = html.replace(/<p>(<[uo]l>)/g, '$1');
        html = html.replace(/(<\/[uo]l>)<\/p>/g, '$1');
        html = html.replace(/<p>(<pre>)/g, '$1');
        html = html.replace(/(<\/pre>)<\/p>/g, '$1');

        return html;
      }

      // Загрузка файла
      const params = new URLSearchParams(window.location.search);
      const file = params.get('file');

      if (!file) {
        document.getElementById('content').innerHTML =
          '<div class="error"><strong>Ошибка:</strong> Не указан файл для просмотра</div>';
      } else {
        fetch(`/${file}`)
          .then((response) => {
            if (!response.ok) throw new Error('Файл не найден');
            return response.text();
          })
          .then((markdown) => {
            const html = parseMarkdown(markdown);
            document.getElementById('content').innerHTML = html;
            document.title =
              file.split('/').pop().replace('.md', '') + ' - Документация';
          })
          .catch((error) => {
            document.getElementById('content').innerHTML =
              '<div class="error"><strong>Ошибка:</strong> ' +
              error.message +
              '</div>';
          });
      }
    </script>
  </body>
</html>
